import{z as Qe,u as He,r,A as Ge,L as Je,d as s,K as me,o as m,c as M,B as _,C as W,e as t,w as o,x as u,h as ce,G as X,M as Z,i as h,j as A,v as fe,k as E,n as i,q as We,J as P}from"./index.b8b61c20.js";import{l as Xe,e as Ze,f as el,g as ve,h as ll,i as tl,j as ol,k as al}from"./role.a0eca7cb.js";import{r as nl,t as ul}from"./menu.4ecde05e.js";const dl={class:"app-container"},sl=i("\u641C\u7D22"),rl=i("\u91CD\u7F6E"),il=i("\u65B0\u589E"),pl=i("\u4FEE\u6539"),ml=i("\u5220\u9664"),cl=i("\u5BFC\u51FA"),fl=i(" \u6743\u9650\u5B57\u7B26 "),vl=i("\u5C55\u5F00/\u6298\u53E0"),_l=i("\u5168\u9009/\u5168\u4E0D\u9009"),hl=i("\u7236\u5B50\u8054\u52A8"),yl={class:"dialog-footer"},gl=i("\u786E \u5B9A"),kl=i("\u53D6 \u6D88"),bl=i("\u5C55\u5F00/\u6298\u53E0"),Vl=i("\u5168\u9009/\u5168\u4E0D\u9009"),Cl=i("\u7236\u5B50\u8054\u52A8"),Sl={class:"dialog-footer"},wl=i("\u786E \u5B9A"),xl=i("\u53D6 \u6D88"),Kl=Qe({name:"Role"}),Dl=Object.assign(Kl,{setup(Ul){const _e=He(),{proxy:v}=We(),{sys_normal_disable:ee}=v.useDict("sys_normal_disable"),le=r([]),C=r(!1),L=r(!0),z=r(!0),B=r([]),te=r(!0),oe=r(!0),F=r(0),x=r(""),R=r([]),K=r([]),O=r(!1),Y=r(!1),j=r(!0),Q=r(!1),D=r([]),U=r(!1),y=r(null),g=r(null),he=r([{value:"1",label:"\u5168\u90E8\u6570\u636E\u6743\u9650"},{value:"2",label:"\u81EA\u5B9A\u6570\u636E\u6743\u9650"},{value:"3",label:"\u672C\u90E8\u95E8\u6570\u636E\u6743\u9650"},{value:"4",label:"\u672C\u90E8\u95E8\u53CA\u4EE5\u4E0B\u6570\u636E\u6743\u9650"},{value:"5",label:"\u4EC5\u672C\u4EBA\u6570\u636E\u6743\u9650"}]),ye=Ge({form:{},queryParams:{pageNum:1,pageSize:10,roleName:void 0,roleKey:void 0,status:void 0},rules:{roleName:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],roleKey:[{required:!0,message:"\u6743\u9650\u5B57\u7B26\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],roleSort:[{required:!0,message:"\u89D2\u8272\u987A\u5E8F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}),{queryParams:c,form:n,rules:ge}=Je(ye);function k(){L.value=!0,Xe(v.addDateRange(c.value,R.value)).then(a=>{le.value=a.rows,F.value=a.total,L.value=!1})}function T(){c.value.pageNum=1,k()}function ke(){R.value=[],v.resetForm("queryRef"),T()}function ae(a){const e=a.roleId||B.value;v.$modal.confirm('\u662F\u5426\u786E\u8BA4\u5220\u9664\u89D2\u8272\u7F16\u53F7\u4E3A"'+e+'"\u7684\u6570\u636E\u9879?').then(function(){return Ze(e)}).then(()=>{k(),v.$modal.msgSuccess("\u5220\u9664\u6210\u529F")}).catch(()=>{})}function be(){v.download("system/role/export",{...c.value},`role_${new Date().getTime()}.xlsx`)}function Ve(a){B.value=a.map(e=>e.roleId),te.value=a.length!=1,oe.value=!a.length}function Ce(a){let e=a.status==="0"?"\u542F\u7528":"\u505C\u7528";v.$modal.confirm('\u786E\u8BA4\u8981"'+e+'""'+a.roleName+'"\u89D2\u8272\u5417?').then(function(){return el(a.roleId,a.status)}).then(()=>{v.$modal.msgSuccess(e+"\u6210\u529F")}).catch(function(){a.status=a.status==="0"?"1":"0"})}function Se(a){_e.push("/system/role-auth/user/"+a.roleId)}function we(){ul().then(a=>{K.value=a.data})}function xe(){let a=g.value.getCheckedKeys(),e=g.value.getHalfCheckedKeys();return a.unshift.apply(a,e),a}function N(){y.value!=null&&y.value.setCheckedKeys([]),O.value=!1,Y.value=!1,j.value=!0,Q.value=!1,n.value={roleId:void 0,roleName:void 0,roleKey:void 0,roleSort:0,status:"0",menuIds:[],deptIds:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},v.resetForm("roleRef")}function Ke(){N(),we(),C.value=!0,x.value="\u6DFB\u52A0\u89D2\u8272"}function ne(a){N();const e=a.roleId||B.value,p=Ue(e);ve(e).then(d=>{n.value=d.data,n.value.roleSort=Number(n.value.roleSort),C.value=!0,P(()=>{p.then($=>{$.checkedKeys.forEach(G=>{P(()=>{y.value.setChecked(G,!0,!1)})})})}),x.value="\u4FEE\u6539\u89D2\u8272"})}function Ue(a){return nl(a).then(e=>(K.value=e.menus,e))}function Ne(a){return al(a).then(e=>(D.value=e.depts,e))}function ue(a,e){if(e=="menu"){let p=K.value;for(let d=0;d<p.length;d++)y.value.store.nodesMap[p[d].id].expanded=a}else if(e=="dept"){let p=D.value;for(let d=0;d<p.length;d++)g.value.store.nodesMap[p[d].id].expanded=a}}function de(a,e){e=="menu"?y.value.setCheckedNodes(a?K.value:[]):e=="dept"&&g.value.setCheckedNodes(a?D.value:[])}function se(a,e){e=="menu"?n.value.menuCheckStrictly=!!a:e=="dept"&&(n.value.deptCheckStrictly=!!a)}function re(){let a=y.value.getCheckedKeys(),e=y.value.getHalfCheckedKeys();return a.unshift.apply(a,e),a}function Ie(){v.$refs.roleRef.validate(a=>{a&&(n.value.roleId!=null?(n.value.menuIds=re(),ll(n.value).then(e=>{v.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F"),C.value=!1,k()})):(n.value.menuIds=re(),tl(n.value).then(e=>{v.$modal.msgSuccess("\u65B0\u589E\u6210\u529F"),C.value=!1,k()})))})}function Re(){C.value=!1,N()}function De(a){a!=="2"&&g.value.setCheckedKeys([])}function Te(a){N();const e=Ne(a.roleId);ve(a.roleId).then(p=>{n.value=p.data,U.value=!0,P(()=>{e.then(d=>{P(()=>{g.value&&g.value.setCheckedKeys(d.checkedKeys)})})}),x.value="\u5206\u914D\u6570\u636E\u6743\u9650"})}function $e(){n.value.roleId!=null&&(n.value.deptIds=xe(),ol(n.value).then(a=>{v.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F"),U.value=!1,k()}))}function qe(){U.value=!1,N()}return k(),(a,e)=>{const p=s("el-input"),d=s("el-form-item"),$=s("el-option"),H=s("el-select"),G=s("el-date-picker"),f=s("el-button"),J=s("el-form"),q=s("el-col"),Me=s("right-toolbar"),Ae=s("el-row"),b=s("el-table-column"),Ee=s("el-switch"),I=s("el-tooltip"),Pe=s("el-table"),Le=s("pagination"),ze=s("question-filled"),Be=s("el-icon"),Fe=s("el-input-number"),Oe=s("el-radio"),Ye=s("el-radio-group"),S=s("el-checkbox"),ie=s("el-tree"),pe=s("el-dialog"),V=me("hasPermi"),je=me("loading");return m(),M("div",dl,[_(t(J,{model:u(c),ref:"queryRef",inline:!0},{default:o(()=>[t(d,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:o(()=>[t(p,{modelValue:u(c).roleName,"onUpdate:modelValue":e[0]||(e[0]=l=>u(c).roleName=l),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",clearable:"",style:{width:"240px"},onKeyup:ce(T,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(d,{label:"\u6743\u9650\u5B57\u7B26",prop:"roleKey"},{default:o(()=>[t(p,{modelValue:u(c).roleKey,"onUpdate:modelValue":e[1]||(e[1]=l=>u(c).roleKey=l),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u5B57\u7B26",clearable:"",style:{width:"240px"},onKeyup:ce(T,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(d,{label:"\u72B6\u6001",prop:"status"},{default:o(()=>[t(H,{modelValue:u(c).status,"onUpdate:modelValue":e[2]||(e[2]=l=>u(c).status=l),placeholder:"\u89D2\u8272\u72B6\u6001",clearable:"",style:{width:"240px"}},{default:o(()=>[(m(!0),M(X,null,Z(u(ee),l=>(m(),h($,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"\u521B\u5EFA\u65F6\u95F4",style:{width:"308px"}},{default:o(()=>[t(G,{modelValue:R.value,"onUpdate:modelValue":e[3]||(e[3]=l=>R.value=l),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(f,{type:"primary",icon:"Search",onClick:T},{default:o(()=>[sl]),_:1}),t(f,{icon:"Refresh",onClick:ke},{default:o(()=>[rl]),_:1})]),_:1})]),_:1},8,["model"]),[[W,z.value]]),t(Ae,{gutter:10,class:"mb8"},{default:o(()=>[t(q,{span:1.5},{default:o(()=>[_((m(),h(f,{type:"primary",plain:"",icon:"Plus",onClick:Ke},{default:o(()=>[il]),_:1})),[[V,["system:role:add"]]])]),_:1},8,["span"]),t(q,{span:1.5},{default:o(()=>[_((m(),h(f,{type:"success",plain:"",icon:"Edit",disabled:te.value,onClick:ne},{default:o(()=>[pl]),_:1},8,["disabled"])),[[V,["system:role:edit"]]])]),_:1},8,["span"]),t(q,{span:1.5},{default:o(()=>[_((m(),h(f,{type:"danger",plain:"",icon:"Delete",disabled:oe.value,onClick:ae},{default:o(()=>[ml]),_:1},8,["disabled"])),[[V,["system:role:remove"]]])]),_:1},8,["span"]),t(q,{span:1.5},{default:o(()=>[_((m(),h(f,{type:"warning",plain:"",icon:"Download",onClick:be},{default:o(()=>[cl]),_:1})),[[V,["system:role:export"]]])]),_:1},8,["span"]),t(Me,{showSearch:z.value,"onUpdate:showSearch":e[4]||(e[4]=l=>z.value=l),onQueryTable:k},null,8,["showSearch"])]),_:1}),_((m(),h(Pe,{data:le.value,onSelectionChange:Ve},{default:o(()=>[t(b,{type:"selection",width:"55",align:"center"}),t(b,{label:"\u89D2\u8272\u7F16\u53F7",prop:"roleId",width:"120"}),t(b,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName","show-overflow-tooltip":!0,width:"150"}),t(b,{label:"\u6743\u9650\u5B57\u7B26",prop:"roleKey","show-overflow-tooltip":!0,width:"150"}),t(b,{label:"\u663E\u793A\u987A\u5E8F",prop:"roleSort",width:"100"}),t(b,{label:"\u72B6\u6001",align:"center",width:"100"},{default:o(l=>[t(Ee,{modelValue:l.row.status,"onUpdate:modelValue":w=>l.row.status=w,"active-value":"0","inactive-value":"1",onChange:w=>Ce(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(b,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"createTime"},{default:o(l=>[A("span",null,fe(a.parseTime(l.row.createTime)),1)]),_:1}),t(b,{label:"\u64CD\u4F5C",align:"center","class-name":"small-padding fixed-width"},{default:o(l=>[l.row.roleId!==1?(m(),h(I,{key:0,content:"\u4FEE\u6539",placement:"top"},{default:o(()=>[_(t(f,{type:"text",icon:"Edit",onClick:w=>ne(l.row)},null,8,["onClick"]),[[V,["system:role:edit"]]])]),_:2},1024)):E("",!0),l.row.roleId!==1?(m(),h(I,{key:1,content:"\u5220\u9664",placement:"top"},{default:o(()=>[_(t(f,{type:"text",icon:"Delete",onClick:w=>ae(l.row)},null,8,["onClick"]),[[V,["system:role:remove"]]])]),_:2},1024)):E("",!0),l.row.roleId!==1?(m(),h(I,{key:2,content:"\u6570\u636E\u6743\u9650",placement:"top"},{default:o(()=>[_(t(f,{type:"text",icon:"CircleCheck",onClick:w=>Te(l.row)},null,8,["onClick"]),[[V,["system:role:edit"]]])]),_:2},1024)):E("",!0),l.row.roleId!==1?(m(),h(I,{key:3,content:"\u5206\u914D\u7528\u6237",placement:"top"},{default:o(()=>[_(t(f,{type:"text",icon:"User",onClick:w=>Se(l.row)},null,8,["onClick"]),[[V,["system:role:edit"]]])]),_:2},1024)):E("",!0)]),_:1})]),_:1},8,["data"])),[[je,L.value]]),_(t(Le,{total:F.value,page:u(c).pageNum,"onUpdate:page":e[5]||(e[5]=l=>u(c).pageNum=l),limit:u(c).pageSize,"onUpdate:limit":e[6]||(e[6]=l=>u(c).pageSize=l),onPagination:k},null,8,["total","page","limit"]),[[W,F.value>0]]),t(pe,{title:x.value,modelValue:C.value,"onUpdate:modelValue":e[18]||(e[18]=l=>C.value=l),width:"500px","append-to-body":""},{footer:o(()=>[A("div",yl,[t(f,{type:"primary",onClick:Ie},{default:o(()=>[gl]),_:1}),t(f,{onClick:Re},{default:o(()=>[kl]),_:1})])]),default:o(()=>[t(J,{ref:"roleRef",model:u(n),rules:u(ge),"label-width":"100px"},{default:o(()=>[t(d,{label:"\u89D2\u8272\u540D\u79F0",prop:"roleName"},{default:o(()=>[t(p,{modelValue:u(n).roleName,"onUpdate:modelValue":e[7]||(e[7]=l=>u(n).roleName=l),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(d,{prop:"roleKey"},{label:o(()=>[A("span",null,[t(I,{content:"\u63A7\u5236\u5668\u4E2D\u5B9A\u4E49\u7684\u6743\u9650\u5B57\u7B26\uFF0C\u5982\uFF1A@PreAuthorize(`@ss.hasRole('admin')`)",placement:"top"},{default:o(()=>[t(Be,null,{default:o(()=>[t(ze)]),_:1})]),_:1}),fl])]),default:o(()=>[t(p,{modelValue:u(n).roleKey,"onUpdate:modelValue":e[8]||(e[8]=l=>u(n).roleKey=l),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u5B57\u7B26"},null,8,["modelValue"])]),_:1}),t(d,{label:"\u89D2\u8272\u987A\u5E8F",prop:"roleSort"},{default:o(()=>[t(Fe,{modelValue:u(n).roleSort,"onUpdate:modelValue":e[9]||(e[9]=l=>u(n).roleSort=l),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),t(d,{label:"\u72B6\u6001"},{default:o(()=>[t(Ye,{modelValue:u(n).status,"onUpdate:modelValue":e[10]||(e[10]=l=>u(n).status=l)},{default:o(()=>[(m(!0),M(X,null,Z(u(ee),l=>(m(),h(Oe,{key:l.value,label:l.value},{default:o(()=>[i(fe(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"\u83DC\u5355\u6743\u9650"},{default:o(()=>[t(S,{modelValue:O.value,"onUpdate:modelValue":e[11]||(e[11]=l=>O.value=l),onChange:e[12]||(e[12]=l=>ue(l,"menu"))},{default:o(()=>[vl]),_:1},8,["modelValue"]),t(S,{modelValue:Y.value,"onUpdate:modelValue":e[13]||(e[13]=l=>Y.value=l),onChange:e[14]||(e[14]=l=>de(l,"menu"))},{default:o(()=>[_l]),_:1},8,["modelValue"]),t(S,{modelValue:u(n).menuCheckStrictly,"onUpdate:modelValue":e[15]||(e[15]=l=>u(n).menuCheckStrictly=l),onChange:e[16]||(e[16]=l=>se(l,"menu"))},{default:o(()=>[hl]),_:1},8,["modelValue"]),t(ie,{class:"tree-border",data:K.value,"show-checkbox":"",ref_key:"menuRef",ref:y,"node-key":"id","check-strictly":!u(n).menuCheckStrictly,"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1}),t(d,{label:"\u5907\u6CE8"},{default:o(()=>[t(p,{modelValue:u(n).remark,"onUpdate:modelValue":e[17]||(e[17]=l=>u(n).remark=l),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(pe,{title:x.value,modelValue:U.value,"onUpdate:modelValue":e[28]||(e[28]=l=>U.value=l),width:"500px","append-to-body":""},{footer:o(()=>[A("div",Sl,[t(f,{type:"primary",onClick:$e},{default:o(()=>[wl]),_:1}),t(f,{onClick:qe},{default:o(()=>[xl]),_:1})])]),default:o(()=>[t(J,{model:u(n),"label-width":"80px"},{default:o(()=>[t(d,{label:"\u89D2\u8272\u540D\u79F0"},{default:o(()=>[t(p,{modelValue:u(n).roleName,"onUpdate:modelValue":e[19]||(e[19]=l=>u(n).roleName=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(d,{label:"\u6743\u9650\u5B57\u7B26"},{default:o(()=>[t(p,{modelValue:u(n).roleKey,"onUpdate:modelValue":e[20]||(e[20]=l=>u(n).roleKey=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(d,{label:"\u6743\u9650\u8303\u56F4"},{default:o(()=>[t(H,{modelValue:u(n).dataScope,"onUpdate:modelValue":e[21]||(e[21]=l=>u(n).dataScope=l),onChange:De},{default:o(()=>[(m(!0),M(X,null,Z(he.value,l=>(m(),h($,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),_(t(d,{label:"\u6570\u636E\u6743\u9650"},{default:o(()=>[t(S,{modelValue:j.value,"onUpdate:modelValue":e[22]||(e[22]=l=>j.value=l),onChange:e[23]||(e[23]=l=>ue(l,"dept"))},{default:o(()=>[bl]),_:1},8,["modelValue"]),t(S,{modelValue:Q.value,"onUpdate:modelValue":e[24]||(e[24]=l=>Q.value=l),onChange:e[25]||(e[25]=l=>de(l,"dept"))},{default:o(()=>[Vl]),_:1},8,["modelValue"]),t(S,{modelValue:u(n).deptCheckStrictly,"onUpdate:modelValue":e[26]||(e[26]=l=>u(n).deptCheckStrictly=l),onChange:e[27]||(e[27]=l=>se(l,"dept"))},{default:o(()=>[Cl]),_:1},8,["modelValue"]),t(ie,{class:"tree-border",data:D.value,"show-checkbox":"","default-expand-all":"",ref_key:"deptRef",ref:g,"node-key":"id","check-strictly":!u(n).deptCheckStrictly,"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019",props:{label:"label",children:"children"}},null,8,["data","check-strictly"])]),_:1},512),[[W,u(n).dataScope==2]])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{Dl as default};
